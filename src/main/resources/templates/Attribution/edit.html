<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Authentification Bootstrap 4 Spring Boot.">
    <meta name="author" content="Ghislain Nkagou">
    <title th:utext="${title}"></title>

    <!-- Include CSS block -->
    <th:block th:include="main/layout/block_css"></th:block>
    <style>
        .custom-check-input:checked + .custom-check-label::before {
            border-color: red;
            background-color: red;
        }
        .additional-fields {
            display: none;
        }

        .additional-fields2 {
            display: none;
        }
        .form-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 10px 20px;
        }
        .form-body {
            padding: 20px;
        }
        .form-footer {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        .form-footer button {
            width: 100%;
        }
    </style>
    <script>
        function toggleAdditionalFields2() {
            var radioIndisponible = document.getElementById("radio-indisponible2");
            var additionalFields = document.getElementById("additional-fields2");

            additionalFields.style.display = radioIndisponible.checked ? "block" : "none";
        }
    </script>
    <script>
        function toggleAdditionalFields() {
            var radioIndisponible = document.getElementById("radio-indisponible");
            var additionalFields = document.getElementById("additional-fields");

            if (radioIndisponible.checked) {
                additionalFields.style.display = "block";
            } else {
                additionalFields.style.display = "none";
            }
        }
    </script>

</head>

<body>

<!-- Include MENU block -->
<th:block th:include="main/_menu"></th:block>

<!-- page content -->
<br>

<div class="card mx-auto" style="width: 50rem">
    <div class="card-header form-header">
        <div class="row">
            <div class="col-md-8">
                <h5><strong>Terminée la course</strong></h5>
            </div>
        </div>
    </div>

    <div class="card-body form-body">
        <form th:action="@{/Attribution/attribution/user/terminée}" th:object="${attributionDto}" method="post">

            <!-- IdEmployeDmdForm Input -->
            <input th:field="${attributionDto.id}" type="hidden"/>
            <input th:field="${attributionDto.detailVehiculeChauffeurA}" type="hidden"/>
            <input th:field="${attributionDto.employe}" type="hidden"/>

            <div class="form-group row d-none">
                <label th:for="id" class="col-sm-4 col-form-label text-md-right"><strong>Identifiant</strong></label>
                <div class="col-md-6">
                    <input class="form-control" th:field="${attributionDto.id}" required>
                </div>
            </div>

            <div class="form-group row d-none">
                <label class="col-sm-4 col-form-label text-md-right"><strong>Nom de l'utilisateur</strong></label>
                <div class="col-md-6">
                    <input class="form-control" th:field="${attributionDto.detailVehiculeChauffeurA}" required>
                </div>
            </div>

            <div class="form-group row d-none">
                <label class="col-sm-4 col-form-label text-md-right"><strong>Date d'attribution</strong></label>
                <div class="col-md-6">
                    <input class="form-control" th:field="${attributionDto.dateAttribution}" required>
                </div>
            </div>

            <div class="form-group row">
                <label th:for="dateDeDepart" class="col-sm-4 col-form-label text-md-right"><strong>Date de départ</strong></label>
                <div class="col-md-6">
                    <input class="form-control" type="datetime-local" th:field="${attributionDto.dateDeDepart}" required disabled>
                </div>
            </div>

            <div class="form-group row">
                <label th:for="dateArrivee" class="col-sm-4 col-form-label text-md-right"><strong>Date d'arrivée</strong></label>
                <div class="col-md-6">
                    <input class="form-control" type="datetime-local" th:field="*{dateArrivee}" required>
                    <span class="text-danger" th:if="${#fields.hasErrors('dateArrivee')}" th:errors="*{dateArrivee}"></span>
                    <span id="dateArriveeWarning" class="text-danger"></span> <!-- Warning message -->
                </div>
            </div>

            <div class="form-group row">
                <label th:for="kilometrageFin" class="col-sm-4 col-form-label text-md-right"><strong>Kilométrage Fin</strong></label>
                <div class="col-md-6">
                    <input class="form-control"  type="text" th:field="*{kilometrageFin}" required>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-4 col-form-label text-md-right"><strong>Statut du véhicule</strong></label>
                <div class="col-md-6">
                    <div class="border p-3">
                        <div class="form-row">
                            <div class="col-auto">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutVehiculeA}" th:value="DISPONIBLE" id="radio-disponible">
                                    <label class="form-check-label custom-check-label" for="radio-disponible">Disponible</label>
                                </div>
                            </div>
                            <div class="col-auto ml-3">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutVehiculeA}" th:value="INDISPONIBLE" id="radio-indisponible">
                                    <label class="form-check-label custom-check-label" for="radio-indisponible" th:classappend="${attributionDto.statutVehiculeA == 'INDISPONIBLE'} ? 'text-danger'">Indisponible</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!--            <div class="form-group row" id="additional-fields">-->
<!--                &lt;!&ndash; Additional fields here &ndash;&gt;-->
<!--&lt;!&ndash;                <div class="form-group row">&ndash;&gt;-->
<!--&lt;!&ndash;                    <label th:for="motif" class="col-sm-4 col-form-label text-md-right"><strong>Motif</strong></label>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="col-md-5">&ndash;&gt;-->
<!--&lt;!&ndash;                        <select th:field="${attributionDto.motif}" id="motif" name="motif" class="select-type form-control">&ndash;&gt;-->
<!--&lt;!&ndash;                            <option value="">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; Motif -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</option>&ndash;&gt;-->
<!--&lt;!&ndash;                            <option th:each="c:${listMotif}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name() == attributionDto.motif}"></option>&ndash;&gt;-->
<!--&lt;!&ndash;                        </select>&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="observation" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <textarea class="form-control" type="text" th:field="${attributionDto.observation}"></textarea>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <div class="form-group row" id="additional-fields">
                <label th:for="observation" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>
                <div class="col-md-6">
                    <textarea class="form-control" th:field="${attributionDto.observation}" rows="5"></textarea>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-form-label text-md-right"><strong>Statut du chauffeur</strong></label>
                <div class="col-md-6">
                    <div class="border p-3">
                        <div class="form-row">
                            <div class="col-auto">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutChauffeurA}" th:value="DISPONIBLE" id="radio-disponible2" th:checked="${attributionDto.statutChauffeurA == 'DISPONIBLE'}">
                                    <label class="form-check-label custom-check-label" for="radio-disponible2">Disponible</label>
                                </div>
                            </div>
                            <div class="col-auto ml-3">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutChauffeurA}" th:value="INDISPONIBLE" id="radio-indisponible2" th:checked="${attributionDto.statutChauffeurA == 'INDISPONIBLE'}">
                                    <label class="form-check-label custom-check-label" for="radio-indisponible2" th:classappend="${attributionDto.statutChauffeurA == 'INDISPONIBLE'} ? 'text-danger'">Indisponible</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!--            <div class="form-group row" id="additional-fields2">-->
<!--                &lt;!&ndash; Additional fields here &ndash;&gt;-->
<!--&lt;!&ndash;                <div class="form-group row">&ndash;&gt;-->
<!--&lt;!&ndash;                    <label th:for="motifChauffeur" class="col-sm-4 col-form-label text-md-right"><strong>Motif</strong></label>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="col-md-5">&ndash;&gt;-->
<!--&lt;!&ndash;                        <select th:field="${attributionDto.motifChauffeur}" id="motifChauffeur" name="motifChauffeur" class="select-type form-control">&ndash;&gt;-->
<!--&lt;!&ndash;                            <option value="">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; Motif -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</option>&ndash;&gt;-->
<!--&lt;!&ndash;                            <option th:each="c:${listMotifChauffeur}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name() == attributionDto.motifChauffeur}"></option>&ndash;&gt;-->
<!--&lt;!&ndash;                        </select>&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="observationChauffeur" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <textarea class="form-control" type="text" th:field="${attributionDto.observationChauffeur}"></textarea>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <div class="form-group row" id="additional-fields2">
                <label th:for="observationChauffeur" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>
                <div class="col-md-6">
                    <textarea class="form-control" th:field="${attributionDto.observationChauffeur}" rows="5"></textarea>
                </div>
            </div>

            <!--            <div class="form-group row">-->
<!--                <label class="col-sm-4 col-form-label text-md-right"><strong>Statut du véhicule</strong></label>-->
<!--                <div class="col-md-6">-->
<!--                    <div class="border p-3">-->
<!--                        <div class="form-row">-->
<!--                            <div class="col-auto">-->
<!--                                <div class="form-check">-->
<!--                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutVehiculeA}" th:value="DISPONIBLE" id="radio-disponible" onclick="toggleAdditionalFields()">-->
<!--                                    <label class="form-check-label custom-check-label" for="radio-disponible">Disponible</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="col-auto ml-3">-->
<!--                                <div class="form-check">-->
<!--                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutVehiculeA}" th:value="INDISPONIBLE" id="radio-indisponible" onclick="toggleAdditionalFields()">-->
<!--                                    <label class="form-check-label custom-check-label" for="radio-indisponible" th:classappend="${attributionDto.statutVehiculeA == 'INDISPONIBLE'} ? 'text-danger'">Indisponible</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="form-group row additional-fields" id="additional-fields">-->
<!--                &lt;!&ndash; Additional fields here &ndash;&gt;-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="motif" class="col-sm-4 col-form-label text-md-right"><strong>Motif</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <select th:field="${attributionDto.motif}" id="motif" name="motif" class="select-type form-control">-->
<!--                            <option value="">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; Motif -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</option>-->
<!--                            <option th:each="c:${listMotif}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name() == attributionDto.motif}"></option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="observation" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <textarea class="form-control" type="text" th:field="${attributionDto.observation}"></textarea>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="form-group row">-->
<!--                <label class="col-sm-4 col-form-label text-md-right"><strong>Statut du chauffeur</strong></label>-->
<!--                <div class="col-md-6">-->
<!--                    <div class="border p-3">-->
<!--                        <div class="form-row">-->
<!--                            <div class="col-auto">-->
<!--                                <div class="form-check">-->
<!--                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutChauffeurA}" th:value="DISPONIBLE" id="radio-disponible2" th:checked="${attributionDto.statutChauffeurA == 'DISPONIBLE'}" onclick="toggleAdditionalFields2()">-->
<!--                                    <label class="form-check-label custom-check-label" for="radio-disponible2">Disponible</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="col-auto ml-3">-->
<!--                                <div class="form-check">-->
<!--                                    <input type="radio" class="form-check-input custom-check-input" th:field="${attributionDto.statutChauffeurA}" th:value="INDISPONIBLE" id="radio-indisponible2" th:checked="${attributionDto.statutChauffeurA == 'INDISPONIBLE'}" onclick="toggleAdditionalFields2()">-->
<!--                                    <label class="form-check-label custom-check-label" for="radio-indisponible2" th:classappend="${attributionDto.statutChauffeurA == 'INDISPONIBLE'} ? 'text-danger'">Indisponible</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="form-group row additional-fields2" id="additional-fields2">-->
<!--                &lt;!&ndash; Additional fields here &ndash;&gt;-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="motifChauffeur" class="col-sm-4 col-form-label text-md-right"><strong>Motif</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <select th:field="${attributionDto.motifChauffeur}" id="motifChauffeur" name="motifChauffeur" class="select-type form-control">-->
<!--                            <option value="">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; Motif -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</option>-->
<!--                            <option th:each="c:${listMotifChauffeur}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name() == attributionDto.motifChauffeur}"></option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="form-group row">-->
<!--                    <label th:for="observationChauffeur" class="col-sm-4 col-form-label text-md-right"><strong>Observation</strong></label>-->
<!--                    <div class="col-md-5">-->
<!--                        <textarea class="form-control" type="text" th:field="${attributionDto.observationChauffeur}"></textarea>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

            <div class="form-group row d-none">
                <label th:for="employe" class="col-sm-4 col-form-label text-md-right"><strong>Chauffeur</strong></label>
                <div class="col-md-6">
                    <select th:field="${attributionDto.employe}" name="employe" class="select-type form-control" required>
                        <option value="">------- Chauffeur --------</option>
                        <option th:each="c:${listChauffeur}" th:value="${c.idEmploye}" th:text="${c.toNomComplet}" th:selected="*{employe}"></option>
                    </select>
                </div>
            </div>

            <div class="form-group row d-none">
                <label th:for="vehicule" class="col-sm-4 col-form-label text-md-right"><strong>Véhicule</strong></label>
                <div class="col-md-6">
                    <select th:field="${attributionDto.vehicule}" name="vehicule" class="select-type form-control" required>
                        <option value="">--------- Véhicule ---------</option>
                        <option th:each="c:${listVehicule}" th:value="${c.idVehicule}" th:text="${c.immatriculation}" th:selected="*{vehicule}"></option>
                    </select>
                </div>
            </div>

            <div class="form-footer">
                <button id="btnEnregistrer" type="submit" class="btn btn-primary" name="btn">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Include END MENU block -->
<th:block th:include="main/_end_menu"></th:block>

<br/><br/>

<!-- Include SCRIPT block -->
<th:block th:include="main/layout/block_script"></th:block>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("radio-disponible").checked = true;
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("radio-disponible2").checked = true;
    });
</script>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
        // Récupérer la date système
        var currentDate = new Date();

        // Formater la date pour l'input datetime-local (YYYY-MM-DDTHH:MM)
        var formattedDate = currentDate.toISOString().slice(0, 16);

        // Pré-remplir le champ "Date d'arrivée" avec la date système
        document.querySelector("[name='dateArrivee']").value = formattedDate;

        // Ajouter l'écouteur d'événement sur le bouton "Enregistrer"
        document.getElementById("btnEnregistrer").addEventListener("click", function (e) {
            var dateDeDepart = new Date(document.querySelector("[name='dateDeDepart']").value);
            var dateArrivee = new Date(document.querySelector("[name='dateArrivee']").value);
            var kilometrageFin = document.querySelector("[name='kilometrageFin']").value;

            if (dateArrivee < dateDeDepart) {
                e.preventDefault(); // Empêcher la soumission du formulaire
                document.getElementById("dateArriveeWarning").textContent = "La date d'arrivée doit être ultérieure à la date de départ.";
            } else {
                // Réinitialiser le message d'avertissement si les dates sont valides
                document.getElementById("dateArriveeWarning").textContent = "";
            }
            if (kilometrageFin === "") {
                e.preventDefault(); // Empêcher la soumission du formulaire si le kilométrage est vide
                alert("Veuillez entrer le kilométrage d'arrivée.");
            }
        });
    });
</script>

</body>
</html>
